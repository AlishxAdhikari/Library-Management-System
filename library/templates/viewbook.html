{% load static %}
<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Inventory | LibPro LMS</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    body { font-family: 'Plus Jakarta Sans', sans-serif; overflow-x: hidden; }
    
    .sidebar-glass {
      background: rgba(15, 23, 42, 0.9);
      backdrop-filter: blur(20px);
      border-right: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .search-bar {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.3s ease;
    }

    .custom-table { width: 100%; border-collapse: separate; border-spacing: 0 8px; }
    .custom-table tr { transition: all 0.3s ease; }
    .custom-table tbody tr { background: rgba(255, 255, 255, 0.02); }
    .custom-table tbody tr:hover { 
      background: rgba(99, 102, 241, 0.1); 
      transform: scale(1.005);
    }
    
    .text-gradient {
      background: linear-gradient(to right, #818cf8, #c084fc);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .dropdown:hover .dropdown-menu { display: block; }
    .table-container { overflow-x: auto; scrollbar-width: thin; }
  </style>
</head>

<body class="bg-[#020617] text-slate-200 flex">

  <aside class="fixed left-0 top-0 h-screen w-64 sidebar-glass z-[110] hidden lg:flex flex-col p-6">
    <div class="mb-10 flex items-center space-x-2">
      <div class="w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center font-bold">L</div>
      <span class="text-xl font-black tracking-tighter">LIB<span class="text-indigo-500">PRO</span></span>
    </div>

    <nav class="flex-1 space-y-2 text-sm font-medium">
      <a href="{% url 'home' %}" class="flex items-center space-x-3 p-3 rounded-xl hover:bg-white/5 transition">
        <span>üè† Home Dashboard</span>
      </a>
      <a href="{% url 'view-book' %}" class="flex items-center space-x-3 p-3 rounded-xl bg-indigo-600/10 text-indigo-400 border border-indigo-600/20 transition">
        <span>üìö Browse Catalog</span>
      </a>
      <a href="{% url 'add_book' %}" class="flex items-center space-x-3 p-3 rounded-xl hover:bg-white/5 transition">
        <span>‚ûï Add New Volume</span>
      </a>
      <a href="{% url 'about' %}" class="flex items-center space-x-3 p-3 rounded-xl hover:bg-white/5 transition">
        <span>‚ÑπÔ∏è About Archive</span>
      </a>
    </nav>

    <div class="mt-auto pt-6 border-t border-white/5">
      {% if user.is_authenticated %}
      <div class="flex items-center space-x-3 p-2 bg-white/5 rounded-2xl">
        <div class="w-10 h-10 rounded-full bg-indigo-600 flex items-center justify-center font-bold text-xs">{{ user.username|slice:":2"|upper }}</div>
        <div class="overflow-hidden">
          <p class="text-xs font-bold truncate">Hi, {{ user.username }}</p>
          <a href="{% url 'logout' %}" class="text-[10px] text-rose-400 hover:text-rose-300 font-bold uppercase tracking-wider transition">Logout</a>
        </div>
      </div>
      {% endif %}
    </div>
  </aside>

  <main class="flex-1 lg:ml-64 relative min-h-screen flex flex-col">
    
    <header class="sticky top-0 z-[100] px-8 py-4 backdrop-blur-md bg-[#020617]/70 flex items-center justify-between border-b border-white/5">
      <div class="flex-1 max-w-xl">
        <form action="{% url 'view-book' %}" method="get" class="search-bar rounded-xl px-4 py-2 flex items-center space-x-3">
          <span class="text-slate-500 text-sm">üîç</span>
          <input type="search" name="q" value="{{ request.GET.q }}" placeholder="Search by title..." class="bg-transparent border-none outline-none text-sm w-full text-white">
        </form>
      </div>
      
      <div class="ml-4 flex items-center">
        <a href="{% url 'add_book' %}" class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-bold text-xs hover:bg-indigo-500 transition-all flex items-center">
            <span class="mr-2">+</span> NEW ENTRY
        </a>
      </div>
    </header>

    <div class="p-8 lg:p-12">
      {% if messages %}
        {% for message in messages %}
          <div class="mb-6 p-4 rounded-2xl border text-xs font-bold flex items-center transition-all animate-pulse
            {% if message.tags == 'success' %} bg-emerald-500/10 border-emerald-500/20 text-emerald-400 {% else %} bg-red-500/10 border-red-500/20 text-red-400 {% endif %}">
            <span class="mr-2">{% if message.tags == 'success' %}‚úÖ{% else %}‚ö†Ô∏è{% endif %}</span> {{ message }}
          </div>
        {% endfor %}
      {% endif %}

      <div class="mb-10" data-aos="fade-down">
        <h1 class="text-4xl font-black tracking-tight mb-2">Collection <span class="text-gradient">Archive</span></h1>
        <p class="text-slate-500 text-sm">System Database: Managing {{ books|length }} registered volumes.</p>
      </div>

      <div class="table-container" data-aos="fade-up">
        <table class="custom-table text-left text-sm">
          <thead>
            <tr class="text-slate-500 uppercase text-[10px] font-bold tracking-widest">
              <th class="px-6 py-4">ID</th>
              <th class="px-6 py-4">Book Metadata</th>
              <th class="px-6 py-4">Valuation</th>
              <th class="px-6 py-4">Due Date</th>
              <th class="px-6 py-4 text-right">Administrative Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for book in books %}
            <tr class="rounded-xl">
              <td class="px-6 py-4 font-mono text-indigo-400">#{{ forloop.counter|stringformat:"02d" }}</td>
              <td class="px-6 py-4">
                <div class="font-bold text-slate-200">{{ book.title }}</div>
                <div class="text-[10px] text-slate-500 uppercase tracking-tighter">{{ book.author }}</div>
              </td>
              <td class="px-6 py-4 font-semibold">Rs. {{ book.price }}</td>
              <td class="px-6 py-4">
                <span class="px-2 py-1 rounded-md bg-white/5 border border-white/10 text-[10px] text-slate-400">
                  {{ book.return_date|date:"M d, Y"|default:"No Date" }}
                </span>
              </td>
              <td class="px-6 py-4 text-right">
                <div class="flex justify-end space-x-2">
                  <a href="{% url 'edit_book' %}?id={{ book.id }}" class="p-2 rounded-lg hover:bg-indigo-600 transition group" title="Edit">
                    <svg class="w-4 h-4 text-slate-400 group-hover:text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
                  </a>
                  
                  <a href="{% url 'delete-book' %}?id={{ book.id }}" class="p-2 rounded-lg hover:bg-rose-600 transition group" title="Delete">
                    <svg class="w-4 h-4 text-slate-400 group-hover:text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                  </a>
                </div>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="5" class="px-6 py-20 text-center text-slate-500 italic">
                <div class="text-4xl mb-4">üìÇ</div>
                No records detected in this sector.
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </main>

  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script>
    AOS.init({ duration: 800, once: true });
  </script>
</body>
</html>